# Drum App v1.0.0 - Product Spec
> **Project**: Drum App (架子鼓Web应用)  
> **Version**: v1.0.0 (Phases 1-4完成, Phase 5规划中)  
> **Team**: 🎨 Lyra (主力)  
> **PTT Version**: V3  
> **Status**: 等待启动 ⏳  
> **Last Updated**: 2026-02-09

---

## 1. Core Concept (核心价值与视觉风格)

### 1.1 Product Vision
Drum 教学模式帮助架子鼓初学者从零开始系统学习基础节奏，通过**渐进式难度**、**实时反馈**和**游戏化评分**培养演奏技能。

### 1.2 Core Value Proposition
- **零门槛入门**: 无需乐理知识，跟随视觉引导即可开始
- **即时成就感**: 实时判定反馈让每次练习都有进步感
- **科学进阶**: 10首练习曲从60BPM到120BPM渐进
- **游戏化激励**: Combo系统和评级机制增强练习动力

### 1.3 Visual Vibe
- **风格**: 现代暗色主题，霓虹光效
- **色彩语言**: 
  - 🔴 即将敲击 (警告/准备)
  - 🟡 准备敲击 (提示)
  - 🟢 精确敲击 (成功)
  - ✨ Combo高亮 (金色渐变)
- **动效**: 鼓垫脉动、光晕扩散、飘字动画

---

## 2. User Stories (用户故事)

### Story 1: 初学者首次练习
**作为** 架子鼓初学者  
**我想要** 从最简单的四分音符开始学习  
**从而** 建立基础节奏感

**Acceptance Criteria**:
- [ ] 第1首练习曲默认解锁
- [ ] 开始前有3-2-1-GO倒计时引导
- [ ] 每个鼓点提前500ms显示高亮提示
- [ ] 敲击后即时显示PERFECT/GOOD/MISS判定
- [ ] 练习结束显示S/A/B/C/D评级

### Story 2: 进阶解锁挑战
**作为** 有进步的用户  
**我想要** 解锁更多练习曲  
**从而** 学习更复杂的节奏

**Acceptance Criteria**:
- [ ] 完成当前曲目C级以上解锁下一首
- [ ] 锁定曲目显示灰色遮罩和锁图标
- [ ] 中级难度需要全部初级曲目平均B级以上解锁
- [ ] 高级难度需要全部中级曲目平均A级以上解锁

### Story 3: 速度挑战
**作为** 熟练用户  
**我想要** 用更快或更慢的速度练习同一曲目  
**从而** 巩固技巧或挑战极限

**Acceptance Criteria**:
- [ ] 每首曲目提供慢速(0.75x)、标准(1.0x)、快速(1.25x)三档
- [ ] 慢速默认解锁
- [ ] 标准速度需慢速达到C级解锁
- [ ] 快速需标准速度达到B级解锁
- [ ] BPM显示实时更新

### Story 4: 进度追踪
**作为** 持续练习的用户  
**我想要** 看到我的进步记录  
**从而** 保持练习动力

**Acceptance Criteria**:
- [ ] 每首曲目显示历史最佳评级
- [ ] 显示历史最高准确率
- [ ] 显示历史最高Combo数
- [ ] 进度数据在本地持久化存储
- [ ] 结算时与新记录对比显示

### Story 5: 实时反馈优化
**作为** 追求精准的用户  
**我想要** 知道每次敲击的准确度  
**从而** 调整我的时机

**Acceptance Criteria**:
- [ ] PERFECT判定: ±50ms时间窗
- [ ] GOOD判定: ±100ms时间窗
- [ ] 提前敲击(>150ms)不触发判定
- [ ] Combo数在10/50/100时显示特效
- [ ] 准确率实时更新显示

---

## 3. Feature List (功能模块)

### P0 - 核心功能 (必须完成)

#### 3.1.1 练习曲系统
| Feature | Description | Priority |
|---------|-------------|----------|
| 10首练习曲 | 初级3首(60-70BPM)、中级4首(80-100BPM)、高级3首(110-120BPM) | P0 |
| 节奏数据 | 每首曲目的精确时间映射(drumId + time) | P0 |
| 解锁机制 | 渐进式解锁，防止难度跳跃 | P0 |
| 速度档位 | 慢速(0.75x)、标准(1.0x)、快速(1.25x) | P0 |

#### 3.1.2 判定系统
| Feature | Description | Priority |
|---------|-------------|----------|
| 时间窗口判定 | PERFECT(±50ms)、GOOD(±100ms)、MISS(±150ms) | P0 |
| 最近音符匹配 | 在200ms窗口内查找最近期望音符 | P0 |
| 漏击检测 | 超过时间窗口未敲击自动记MISS | P0 |
| 判定反馈 | 鼓件颜色闪烁(绿/红) + 飘字动画 | P0 |

#### 3.1.3 评分系统
| Feature | Description | Priority |
|---------|-------------|----------|
| 准确率计算 | (Perfect×1.0 + Good×0.7) / 总数 × 100% | P0 |
| Combo系统 | 连续正确递增，MISS重置 | P0 |
| Combo加成 | 10+(×1.1)、30+(×1.2)、50+(×1.5)、100+(×2.0) | P0 |
| 评级系统 | S(≥95%)、A(≥85%)、B(≥70%)、C(≥50%)、D(<50%) | P0 |

#### 3.1.4 视觉引导
| Feature | Description | Priority |
|---------|-------------|----------|
| 倒计时引导 | 3-2-1-GO全屏动画 | P0 |
| 鼓点提示 | 提前500ms显示高亮 | P0 |
| 节拍器显示 | 4/4拍视觉指示器 | P0 |
| 实时反馈 | 正确/错误视觉反馈 | P0 |

#### 3.1.5 进度存储
| Feature | Description | Priority |
|---------|-------------|----------|
| 本地持久化 | localStorage存储进度 | P0 |
| 最佳记录 | 每首曲目的最佳评级/准确率/Combo | P0 |
| 速度进度 | 各速度档位完成情况 | P0 |
| 数据版本 | 版本号控制，向后兼容 | P0 |

### P1 - 增强功能 (建议完成)

#### 3.2.1 音频节拍器
| Feature | Description | Priority |
|---------|-------------|----------|
| 音频节拍器 | 第一拍高音、其他拍低音 | P1 |
| 音量控制 | 可调节节拍器音量 | P1 |
| 倒计时音效 | 配合视觉的鼓声音效 | P1 |

#### 3.2.2 结算与分享
| Feature | Description | Priority |
|---------|-------------|----------|
| 详细结算 | Perfect/Good/Miss统计 | P1 |
| 新记录提示 | 打破记录时高亮显示 | P1 |
| 下一首快捷 | 结算后直接挑战下一首 | P1 |

### P2 - 优化功能 (可选)

#### 3.3.1 性能优化
| Feature | Description | Priority |
|---------|-------------|----------|
| 低性能降级 | <30fps时简化特效 | P2 |
| 音频延迟校准 | 首次使用引导校准 | P2 |
| 后台暂停 | 切换后台自动暂停 | P2 |

---

## 4. Business Rules (业务规则)

### 4.1 判定规则
| Rule ID | Description | Test Required |
|---------|-------------|---------------|
| BR-001 | PERFECT判定时间窗: ±50ms | ✅ 单元测试 |
| BR-002 | GOOD判定时间窗: ±100ms | ✅ 单元测试 |
| BR-003 | MISS判定时间窗: ±150ms | ✅ 单元测试 |
| BR-004 | 提前敲击>150ms视为无效 | ✅ 单元测试 |
| BR-005 | 每个音符只判定一次 | ✅ 单元测试 |

### 4.2 评分规则
| Rule ID | Description | Test Required |
|---------|-------------|---------------|
| BR-006 | 准确率 = (P×1.0 + G×0.7) / 总音符 × 100% | ✅ 单元测试 |
| BR-007 | PERFECT和GOOD都+1 Combo | ✅ 单元测试 |
| BR-008 | MISS重置Combo为0 | ✅ 单元测试 |
| BR-009 | 评级阈值: S≥95%, A≥85%, B≥70%, C≥50% | ✅ 单元测试 |

### 4.3 解锁规则
| Rule ID | Description | Test Required |
|---------|-------------|---------------|
| BR-010 | 第1首默认解锁 | ✅ 单元测试 |
| BR-011 | 初级解锁: 前一曲C级以上 | ✅ 单元测试 |
| BR-012 | 中级解锁: 全部初级平均B级以上 | ✅ 单元测试 |
| BR-013 | 高级解锁: 全部中级平均A级以上 | ✅ 单元测试 |
| BR-014 | 速度解锁: slow默认, normal需slow C级, fast需normal B级 | ✅ 单元测试 |

### 4.4 数据规则
| Rule ID | Description | Test Required |
|---------|-------------|---------------|
| BR-015 | 进度数据版本号控制(v1) | ✅ 集成测试 |
| BR-016 | localStorage Key: `drum-teaching-progress` | ✅ 集成测试 |
| BR-017 | 练习结束自动保存进度 | ✅ 集成测试 |

---

## 5. UI/UX Specifications (界面规格)

### 5.1 练习曲列表页
```
┌─────────────────────────────────┐
│  🥁 教学模式          [X]关闭   │
├─────────────────────────────────┤
│  ┌─────────┐  ┌─────────┐      │
│  │ 01      │  │ 02      │      │
│  │ 基础四分 │  │ 简单交替 │      │
│  │ [S] 60  │  │ [A] 65  │      │
│  └─────────┘  └─────────┘      │
│  ┌─────────┐  ┌─────────┐      │
│  │ 03      │  │ 04      │      │
│  │ 入门摇滚 │  │ 🔒      │      │
│  │ [B] 70  │  │ 完成03解锁    │
│  └─────────┘  └─────────┘      │
└─────────────────────────────────┘
```

### 5.2 演奏界面
```
┌─────────────────────────────────┐
│  🔥 12    准确率 ████████░░ 82% │
├─────────────────────────────────┤
│        ○ ○ ○ ●                  │  ← 4/4拍指示
│        1 2 3 4                  │
├─────────────────────────────────┤
│   [Kick] [Snare] [HiHat] [Open] │
│    🟢      ⚪      ⚪      ⚪    │  ← 高亮提示
│                                 │
│   [Crash] [TomL] [TomM] [TomH]  │
│    ⚪      ⚪      ⚪      ⚪    │
├─────────────────────────────────┤
│     [  ■ 停止  ] [ ❚❚ 暂停 ]    │
└─────────────────────────────────┘
```

### 5.3 结算界面
```
┌─────────────────────────────────┐
│                                 │
│           ┌─────┐               │
│           │  A  │               │
│           └─────┘               │
│                                 │
│    Perfect: 32  Good: 8         │
│    Miss: 4      Combo: 24       │
│    准确率: 87%                  │
│                                 │
│    [下一首] [重试] [返回]       │
│                                 │
└─────────────────────────────────┘
```

---

## 6. Success Metrics (成功指标)

| Metric | Target | Measurement |
|--------|--------|-------------|
| 判定准确率 | >99% | 测试用例通过率 |
| 60fps保持率 | >95% | 演奏过程中帧率监控 |
| 内存占用 | <50MB | Chrome DevTools |
| 首次可交互 | <3s | Lighthouse |
| 离线可用性 | 100% | 无需网络请求 |

---

## 7. Appendix (附录)

### 7.1 练习曲数据

**初级 (3首)**
| 编号 | 曲名 | BPM | 核心技巧 |
|-----|------|-----|---------|
| 01 | 基础四分音符 | 60 | 单鼓件节奏 |
| 02 | 简单交替 | 65 | 双鼓件配合 |
| 03 | 入门摇滚 | 70 | 基础Rock Beat |

**中级 (4首)**
| 编号 | 曲名 | BPM | 核心技巧 |
|-----|------|-----|---------|
| 04 | 八分音符入门 | 80 | Hi-Hat 8分音符 |
| 05 | 底鼓变化 | 85 | Bass Drum Variation |
| 06 | 流行节奏 | 90 | Pop Groove |
| 07 | 加入 Tom | 100 | Tom Fill |

**高级 (3首)**
| 编号 | 曲名 | BPM | 核心技巧 |
|-----|------|-----|---------|
| 08 | 快速踩镲 | 110 | Fast Hi-Hat |
| 09 | 复杂过门 | 115 | Drum Fill |
| 10 | 大师挑战 | 120 | 综合技巧 |

### 7.2 相关文档
- Tech Spec: `tech_spec.md`
- Task Spec: `task_spec.md`
