# T-003: 评分系统开发

## 基本信息
| 字段 | 值 |
|------|-----|
| Task ID | T-003 |
| 名称 | 评分系统开发 |
| 状态 | ⏳ 待开发 |
| 优先级 | P1 - 重要功能 |
| 负责人 | 待定 |
| 创建日期 | 2026-02-10 |
| 预计完成 | 待定 |

---

## 📋 任务描述

为Drum App开发完善的评分系统，包括实时评分计算、历史记录存储、成就系统和排行榜功能。

---

## 🎯 任务目标

1. **实时评分** - 完善击打评分算法
2. **历史记录** - 持久化存储每次练习的成绩
3. **成就系统** - 设计并实现成就解锁机制
4. **数据统计** - 提供练习数据统计和可视化

---

## ✅ 子任务清单

### 1. 评分算法优化
- [ ] **基础评分计算**
  - Perfect: 100分
  - Good: 50分
  - Miss: 0分
  - 连击加成系数
- [ ] **动态难度调整**
  - 根据准确率调整评分权重
  - 高难度曲目分数加成
- [ ] **评分等级细化**
  - 当前: S/A/B/C/D
  - 考虑增加: S+/S-/SS/SSS等

### 2. 历史记录系统
- [ ] **本地存储**
  - IndexedDB 存储练习记录
  - 记录内容：时间、课程、得分、准确率、判定分布
- [ ] **记录列表**
  - 查看历史练习记录
  - 按课程/日期筛选
  - 删除单条记录
- [ ] **最佳成绩追踪**
  - 每首课程的最佳成绩
  - 全曲库总分统计

### 3. 成就系统
- [ ] **成就设计**
  | 成就ID | 名称 | 描述 | 解锁条件 |
  |--------|------|------|----------|
  | ACH_001 | 初次尝试 | 完成第一次练习 | 完成任意课程 |
  | ACH_002 | 完美开始 | 第一课获得S评级 | L-001评级≥S |
  | ACH_003 | 百击大师 | 累计击打100次 | 总击打数≥100 |
  | ACH_004 | 连击达人 | 达成50连击 | 单次连击≥50 |
  | ACH_005 | 全曲通关 | 完成所有10首课程 | 完成L-001~L-010 |
  | ACH_006 | 完美演奏 | 单首课程全部Perfect | 单首Perfect率100% |
  | ACH_007 | 坚持不懈 | 连续7天练习 | 连续登录7天 |
  | ACH_008 | 速度之星 | 在BPM≥100的课程获得S | 任意快歌评级≥S |
  | ACH_009 | 节奏大师 | 累计获得100个S评级 | S评级数≥100 |
  | ACH_010 | 百分达人 | 单首准确率100% | 准确率=100% |

- [ ] **成就存储**
  - 本地存储成就状态
  - 成就解锁时间记录
- [ ] **成就展示**
  - 成就列表页面
  - 解锁动画效果
  - 分享功能

### 4. 数据统计
- [ ] **个人数据中心**
  - 总练习次数
  - 总练习时长
  - 累计击打次数
  - 平均准确率
  - 最佳连击
- [ ] **判定分布图表**
  - Perfect/Good/Miss比例饼图
  - 准确率趋势折线图
- [ ] **课程完成度**
  - 每首课程的最高评级
  - 完成进度可视化

---

## 🔧 技术要点

### 数据结构
```typescript
// 练习记录
interface PracticeRecord {
  id: string;
  lessonId: string;
  timestamp: number;
  score: number;
  accuracy: number;
  rating: 'S' | 'A' | 'B' | 'C' | 'D';
  combo: number;
  maxCombo: number;
  judgments: {
    perfect: number;
    good: number;
    miss: number;
    total: number;
  };
  duration: number; // 练习时长(秒)
}

// 成就
interface Achievement {
  id: string;
  name: string;
  description: string;
  icon: string;
  unlockedAt: number | null;
  condition: AchievementCondition;
}

// 用户统计
interface UserStats {
  totalPractices: number;
  totalDuration: number;
  totalHits: number;
  averageAccuracy: number;
  bestCombo: number;
  achievements: string[]; // 已解锁成就ID
  bestScores: Record<string, PracticeRecord>; // 每首课程最佳成绩
}
```

### 存储方案
- **IndexedDB**: 大量练习记录
- **localStorage**: 轻量统计数据和成就

---

## 📁 相关文件

```
src/
├── components/
│   ├── ScorePanel.vue         # 评分面板组件
│   ├── HistoryList.vue        # 历史记录列表
│   ├── AchievementPanel.vue   # 成就展示面板
│   └── StatsChart.vue         # 统计图表组件
├── stores/
│   ├── useScoreStore.ts       # 评分状态管理
│   ├── useHistoryStore.ts     # 历史记录管理
│   └── useAchievementStore.ts # 成就系统管理
├── composables/
│   └── useIndexedDB.ts        # IndexedDB封装
└── utils/
    └── scoring.ts             # 评分计算工具
```

---

## ✅ 验收标准

| 标准 | 状态 | 说明 |
|------|------|------|
| 评分计算准确 | ⏳ | 判定与分数对应正确 |
| 历史记录完整 | ⏳ | 记录所有必要信息 |
| 成就系统可用 | ⏳ | 10个成就可解锁 |
| 数据可视化 | ⏳ | 图表清晰展示 |
| 本地存储持久化 | ⏳ | 刷新后数据不丢失 |

---

## 📝 CTT提交规范

```
feat(drum): T-003 评分系统开发

- 关键任务: 1）评分算法 2）历史记录 3）成就系统
- 状态: 🔄进行中
- 团队: 🎨Lyra(主力)
```

---

## 🔗 关联任务

- 前置: T-001（教学模式与判定系统）
- 后续: T-004（解锁机制实现）
- 依赖: T-001, T-002

---

**状态:** ✅ 已完成
