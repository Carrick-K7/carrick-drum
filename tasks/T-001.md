# T-001: 教学模式与判定系统

## 基本信息
| 字段 | 值 |
|------|-----|
| Task ID | T-001 |
| 名称 | 教学模式与判定系统 |
| 状态 | ✅ 已完成 |
| 优先级 | P0 - 核心基础 |
| 负责人 | 🎨 Lyra |
| 创建日期 | 2026-02-09 |
| 完成日期 | 2026-02-10 |

---

## 📋 任务描述

实现Drum App的核心教学模式，包括精确的判定系统、实时反馈UI和基础课程数据。

---

## 🎯 任务目标

1. **判定系统开发** - 实现毫秒级精度的击打判定
2. **教学UI开发** - 构建完整的教学流程界面
3. **基础课程数据** - 创建初学者入门课程

---

## ✅ 子任务清单

### 1. 判定系统核心
- [x] 判定逻辑（Perfect/Good/Miss/None）
  - Perfect: ±50ms 误差窗口
  - Good: ±100ms 误差窗口  
  - Miss: ±150ms 误差窗口
  - None: 超过判定窗口
- [x] 时间窗口计算（基于毫秒级精度）
- [x] 连击系统（Combo）
- [x] 漏击检测（自动检测未击打的节拍）
- [x] 统计系统（准确率、评级 S/A/B/C/D）
- [x] 单元测试（21个测试用例）

### 2. 教学UI组件
- [x] LessonSelector - 课程列表选择
- [x] LessonPanel - 教学主界面（介绍/练习/完成）
- [x] JudgmentFeedback - 实时判定反馈显示
- [x] BeatGuide - 视觉节拍引导（时间轴 + 倒计时环）

### 3. 基础课程数据
- [x] 第一课：基础四分音符
  - BPM: 60（适合初学者的慢速）
  - 时长: 16秒 (4小节 × 4拍)
  - 鼓组: Kick + Snare
- [x] 第二课：加入踩镲
  - BPM: 60
  - 时长: 16秒
  - 鼓组: Kick + Snare + HiHat-Closed

### 4. 状态管理
- [x] useTeachingStore - 教学模式完整状态管理
- [x] 课程流程控制（介绍 → 倒计时 → 练习 → 完成）
- [x] 实时进度追踪
- [x] 统计数据计算

---

## 🔧 技术要点

1. **精确判定引擎**: 毫秒级精度的时间窗口判定
2. **响应式UI**: 使用Vue3 Composition API + Pinia状态管理
3. **视觉引导**: 创新的节拍倒计时环设计
4. **模块架构**: 核心逻辑与UI分离，便于扩展
5. **60fps动画**: `requestAnimationFrame` 驱动游戏循环

---

## 🧪 测试覆盖

| 测试文件 | 用例数 | 状态 |
|----------|--------|------|
| `src/core/__tests__/judgment.spec.ts` | 21 | ✅ 全部通过 |

### 测试内容
- Perfect判定边界测试 (±50ms)
- Good判定边界测试 (51-100ms)
- Miss判定边界测试 (101-150ms)
- 提前/延迟击打测试
- 连击系统测试
- 漏击检测测试

---

## 📁 相关文件

```
src/
├── components/
│   ├── BeatGuide.vue          # 节拍视觉引导
│   ├── JudgmentFeedback.vue   # 判定反馈显示
│   ├── LessonPanel.vue        # 教学主界面
│   └── LessonSelector.vue     # 课程选择器
├── core/
│   ├── judgment.ts            # 判定系统核心
│   └── __tests__/
│       └── judgment.spec.ts   # 判定系统测试
├── data/
│   └── lessons/
│       └── index.ts           # 练习曲数据
├── stores/
│   └── useTeachingStore.ts    # 教学模式状态
└── types/
    └── index.ts               # 类型定义
```

---

## ✅ 验收标准

| 标准 | 状态 | 说明 |
|------|------|------|
| 用户可以完整学完一首歌 | ✅ | 课程流程：介绍 → 倒计时 → 练习 → 完成 |
| 判定准确（误差<50ms） | ✅ | Perfect窗口精确到±50ms |
| UI流畅无卡顿 | ✅ | requestAnimationFrame驱动，60fps |
| 教学模式可用 | ✅ | 所有功能正常 |

---

## 📝 CTT提交规范

```
feat(drum): T-001 教学模式与判定系统

- 关键任务: 1）判定逻辑 2）时间窗口 3）测试覆盖
- 状态: ✅已完成
- 团队: 🎨Lyra(主力)
```

---

## 🔗 关联任务

- 前置: 无（基础任务）
- 后续: T-002（10首练习曲库）
- 依赖: 无

---

**状态:** ✅ 已完成 | **验收日期:** 2026-02-10 | **验收人:** 🧪 Jason
